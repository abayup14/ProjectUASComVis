<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles.css">

    <title>Project UAS COMVIS</title>
</head>

<body>
    <div class="container my-4 py-2 px-lg-4 px-md-2 bg-light-subtle rounded">
        <h2 class="display-3 mb-0">Project</h2>
        <h2 class="display-3 mb-4">Computer Vision</h2>
        <h4 class="display-6">Text from Picture:</h4>
        <div class="row p-2 m-3">
            <div class="col-6 text-center">

                <button class="btn btn-lg btn-outline-primary px-5" id="btn-camera">
                    <i class="bi bi-camera" style="font-size: 2rem" id="icon-camera"></i>
                    <p id="text-camera">Use Camera</p>
                </button>
            </div>
            <div class="col-6 text-center">
                <button class="btn btn-lg btn-outline-secondary px-5" id="btn-gallery">
                    <i class="bi bi-image" style="font-size: 2rem"></i>
                    <p>From Gallery</p>
                </button>
            </div>
        </div>
        <div id="live-feed-webcam">
            <video autoplay="true" id="video-webcam">
                Browsermu tidak mendukung bro, upgrade donk!
            </video>
        </div>
        <div id="show-image" style="display: none;">

        </div>
        <div id="result" style="display: none;">

        </div>
    </div>
    <footer class="fixed-bottom bg-success-subtle">
        <div class="text-wrapper justify-content-end">
            <p class="text-animate text-center m-2">
                Nama Kelompok:
                <strong> 160421033 - Zefanya Isaac Santoso </strong>|
                <strong> 160421058 - Andreas Bayu Prakarsa </strong>|
                <strong> 160421093 - Stewart Wibowo </strong>
            </p>
        </div>
    </footer>
    <script type="text/javascript">
        var video = document.querySelector("#video-webcam");
        var startButton = document.querySelector("#btn-camera");
        var cameraText = document.querySelector("#text-camera");
        var stream = null;
        // Event listener pada tombol
        startButton.addEventListener("click", function () {
            if (!stream) {
                navigator.getUserMedia =
                    navigator.getUserMedia ||
                    navigator.webkitGetUserMedia ||
                    navigator.mozGetUserMedia ||
                    navigator.msGetUserMedia ||
                    navigator.oGetUserMedia;

                // Jika user memberikan izin
                if (navigator.getUserMedia) {
                    // Jalankan fungsi handleVideo jika izin diberikan, dan videoError jika ditolak
                    navigator.getUserMedia({ video: true }, handleVideo, videoError);
                }
            } else {
                // Menghentikan webcam
                stopWebcam();
            }
            // Minta izin user

        });

        // Fungsi ini akan dieksekusi jika izin diberikan
        function handleVideo(mediaStream) {
            stream = mediaStream;
            video.srcObject = mediaStream;
            video.style.display = "block"; // Tampilkan elemen video
            cameraText.textContent = "Stop Camera"; // Ubah teks tombol
        }

        // Fungsi ini akan dieksekusi kalau user menolak izin
        function videoError(e) {
            alert("Izinkan menggunakan webcam untuk demo!");
        }

        // Fungsi untuk menghentikan stream video
        function stopWebcam() {
            stream.getTracks().forEach(track => track.stop()); // Hentikan semua track dalam stream
            video.srcObject = null; // Hapus sumber video
            video.style.display = "none"; // Sembunyikan elemen video
            cameraText.textContent = "Use Camera"; // Ubah teks tombol
            stream = null; // Reset stream
        }

    </script>
</body>

</html>